---
import { getCollection } from 'astro:content';
const posts = (await getCollection('blog')).sort((a, b) => (b.data.pubDate || '').localeCompare(a.data.pubDate || ''));
const base = (import.meta.env.PUBLIC_SITE_URL || Astro.site || 'https://<your-site>.netlify.app').toString().replace(/\/$/, '');
const pageUrl = new URL(Astro.url.pathname, base).toString();
---
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>IELTS コンテンツ</title>
    <link rel="canonical" href={pageUrl} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <main style="max-width:920px;margin:2rem auto;padding:0 1rem;">
      <h1>IELTS コンテンツ</h1>
      <p><a href="/tags/">タグ一覧</a>　<a href="/categories/">カテゴリ一覧</a></p>

      {posts.length === 0 ? (
        <p>まだ記事がありません。ローカルで <code>npm run wxr:convert</code> を実行し、<code>src/content/blog</code> と <code>public/images</code> をコミット＆プッシュしてください。</p>
      ) : (
        <ul>
          {posts.map(p => (
            <li>
              <a href={`/blog/${p.slug}/`}>{p.data.title}</a>
              {p.data.pubDate && <small>（{p.data.pubDate}）</small>}
            </li>
          ))}
        </ul>
      )}
    </main>
  </body>
</html>
