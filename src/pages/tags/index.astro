---
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const tagCounts = {};

// タグの使用回数をカウント
posts.forEach(post => {
  if (post.data.tags) {
    post.data.tags.forEach(tag => {
      tagCounts[tag] = (tagCounts[tag] || 0) + 1;
    });
  }
});

// タグをアルファベット順にソート
const sortedTags = Object.entries(tagCounts)
  .sort(([a], [b]) => a.localeCompare(b))
  .map(([tag, count]) => ({ tag, count }));
---
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>タグ一覧 - IELTS Blog</title>
    <link rel="canonical" href={new URL(Astro.url, import.meta.env?.SITE || import.meta.env?.PUBLIC_SITE_URL || 'https://<your-site>.netlify.app').toString()} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <main style="max-width: 920px; margin: 2rem auto; padding: 0 1rem;">
      <h1>タグ一覧</h1>
      <div style="margin-bottom: 2rem;">
        <a href="/blog/" style="margin-right: 1rem;">← ブログ一覧</a>
        <a href="/categories/">カテゴリ一覧</a>
      </div>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
        {sortedTags.map(({ tag, count }) => (
          <div style="border: 1px solid #ddd; padding: 1rem; border-radius: 8px; text-align: center;">
            <h3 style="margin: 0 0 0.5rem 0;">
              <a href={`/tags/${encodeURIComponent(tag)}/`} style="text-decoration: none; color: #333;">
                #{tag}
              </a>
            </h3>
            <p style="margin: 0; color: #666; font-size: 0.9rem;">
              {count}件の記事
            </p>
          </div>
        ))}
      </div>
      
      {sortedTags.length === 0 && (
        <p style="text-align: center; color: #666; margin-top: 2rem;">
          タグが設定された記事がありません。
        </p>
      )}
    </main>
  </body>
</html>
