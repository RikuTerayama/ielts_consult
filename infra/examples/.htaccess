# URL正規化とリダイレクト設定
# Netlify等のホスティングサービスでは _redirects ファイルを使用してください

RewriteEngine On

# HTTP -> HTTPS（必須）
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# www -> non-www または non-www -> www（どちらかに統一）
# 以下は www を non-www にリダイレクトする例です
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [L,R=301]

# index.html を除去してスラッシュへリダイレクト
RewriteRule ^(.*)/index\.html$ /$1/ [L,R=301]
RewriteRule ^index\.html$ / [L,R=301]

# 大文字を小文字に変換（URL正規化）
RewriteMap tolower int:tolower
RewriteCond %{REQUEST_URI} [A-Z]
RewriteRule (.*) ${tolower:$1} [L,R=301]

# 連続スラッシュを1つに統一
RewriteCond %{THE_REQUEST} \s//+(.*)\sHTTP [NC]
RewriteRule ^.*$ /%1 [R=301,L]

# 不要なクエリパラメータを削除（utm等）
# 注: 特定パラメータのみ許可したい場合は適宜調整
RewriteCond %{QUERY_STRING} (.*)(utm_source|utm_medium|utm_campaign|utm_term|utm_content|gclid)=[^&]*&?(.*)
RewriteRule ^(.*)$ /$1?%1%3 [L,R=301]

# 末尾の?を削除
RewriteCond %{QUERY_STRING} ^$
RewriteRule ^(.*)\?$ /$1 [R=301,L]

# Netlifyの場合
# Netlifyを使用している場合は、この .htaccess の代わりに
# プロジェクトルートに _redirects ファイルを作成し、以下の内容を追加:
#
# # HTTP -> HTTPS
# http://ieltsconsult.netlify.app/* https://ieltsconsult.netlify.app/:splat 301!
#
# # www -> non-www
# http://www.ieltsconsult.netlify.app/* https://ieltsconsult.netlify.app/:splat 301!
# https://www.ieltsconsult.netlify.app/* https://ieltsconsult.netlify.app/:splat 301!

